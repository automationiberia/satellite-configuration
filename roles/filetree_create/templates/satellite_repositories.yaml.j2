---
satellite_repositories: {{ [] if detailed_info.results | length == 0 }}
{% set __excluded_fields = ['created_at', 'updated_at', 'id', 'organization_id', 'http_proxy', 'content_view_version_id', 'last_contents_changed' ] %}
{% set __excluded_subitems = ['id'] %}
{% set __list_items = [] %}
{% set __empty_values = [None, 'None', '', "", {}, [], [{}]] %}
{% for repo in detailed_info.results %}
{%   for __map_item in (repo.json | dict2items) if __map_item.key not in __excluded_fields and __map_item.value not in __empty_values %}
{%     if __map_item.value | type_debug == 'dict' %}
{%       set __map_item_value = dict(__map_item.value.items() | rejectattr('0', 'in', __excluded_subitems) | rejectattr('1', 'in', __empty_values)) %}
{%     endif %}
{%     if __map_item.key in ['organization', 'product'] %}
{%       set __map_item_value = __map_item.value.name %}
{%     endif %}
{%     if (__map_item_value if (__map_item.value | type_debug == 'dict') else __map_item.value) not in __empty_values %}
{%       if loop.index == 1 %}
  - {{ __map_item.key }}: {{ __map_item_value if (__map_item.value | type_debug == 'dict') else __map_item.value | default('""' if __map_item.key not in __list_items else []) | replace("\\'", "''") }}
{%       else %}
    {{ __map_item.key }}: {{ __map_item_value if (__map_item.value | type_debug == 'dict') else __map_item.value | default('""' if __map_item.key not in __list_items else []) | replace("\\'", "''") }}
{%       endif %}
{%     endif %}
{%-  endfor %}
{% endfor %}
...
{#
---
satellite_repositories: {{ [] if detailed_info.results | length == 0 }}
{% for repo in detailed_info.results %}
  - name: "{{ repo.json.name | trim }}"
    label: "{{ repo.json.label }}"
{% if repo.json.description != None and repo.json.description != "" %}
    description: "{{ repo.json.description | regex_replace('[\\r\\n\\t]+',' ') }}"
{% endif %}
{% if repo.json.docker_upstream_name != None and repo.json.docker_upstream_name != "" %}
    docker_upstream_name: "{{ repo.json.docker_upstream_name }}"
    url: "{{ repo.json.url }}"
    http_proxy_policy: "{{ repo.json.http_proxy_policy }}"
{% else %}
{% if repo.json.product.redhat == true %}
    url: "{{ repo.json.url }}"
    http_proxy_policy: "{{ repo.json.http_proxy_policy }}"
{% else %}
{% if repo.json.url != None and repo.json.url != "" %}
    url: "{{ repo.json.url }}"
    http_proxy_policy: "{{ repo.json.http_proxy_policy }}"
{% else %}
    url: "{{ repo.json.full_path }}"
    http_proxy_policy: "none"
{% endif %}
{% endif %}
{% endif %}
    content_type: "{{ repo.json.content_type }}"
{% if repo.json.checksum_type != None and repo.json.checksum_type != "" %}
    checksum_type: "{{ repo.json.checksum_type }}"
{% endif %}
    product: "{{ repo.json.product.name }}"
    redhat: "{{ repo.json.product.redhat }}"
    mirroring_policy: "{{ repo.json.mirroring_policy }}"
{% if repo.json.download_policy != None and repo.json.download_policy != "" %}
    download_policy: "{{ repo.json.download_policy }}"
{% endif %}
{% if repo.json.gpg_key.name != None and repo.json.gpg_key.name != "" %}
    gpg_key: "{{ repo.json.gpg_key.name }}"
{% endif %}
{% endfor %}
#}
